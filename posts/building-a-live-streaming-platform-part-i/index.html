<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Maurício Antunes">
    <meta name="description" content="Maurício Antunes personal website">
    <meta name="keywords" content="blog,software,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building a live streaming platform, part I"/>
<meta name="twitter:description" content="Building a live streaming platform, part I Building a live streaming platform, part II  Have you ever got yourself thinking how live streaming works?
This post is a guide to build your own live streaming platform. After reading and following the examples included on this post, you will be able to publish your content live.
How live streaming works If you consume videos on Youtube, you probably already had contact with a live video transmited over the web."/>

    <meta property="og:title" content="Building a live streaming platform, part I" />
<meta property="og:description" content="Building a live streaming platform, part I Building a live streaming platform, part II  Have you ever got yourself thinking how live streaming works?
This post is a guide to build your own live streaming platform. After reading and following the examples included on this post, you will be able to publish your content live.
How live streaming works If you consume videos on Youtube, you probably already had contact with a live video transmited over the web." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.maugzoide.com/posts/building-a-live-streaming-platform-part-i/" />
<meta property="article:published_time" content="2019-12-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-22T00:00:00+00:00" />


    
      <base href="https://www.maugzoide.com/posts/building-a-live-streaming-platform-part-i/">
    
    <title>
  Building a live streaming platform, part I · Maurício Antunes
</title>

    
      <link rel="canonical" href="https://www.maugzoide.com/posts/building-a-live-streaming-platform-part-i/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.maugzoide.com/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://www.maugzoide.com/css/custom.css" />
    

    
    
    <link rel="icon" type="image/png" href="https://www.maugzoide.com/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.maugzoide.com/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.58.3" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.maugzoide.com/">
      Maurício Antunes
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/">Home</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/posts/">Posts</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/tags/">Tags</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Building a live streaming platform, part I</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2019-12-22T00:00:00Z'>
                December 22, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              4 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://www.maugzoide.com/tags/live-streaming/">live-streaming</a></div>

        </div>
      </header>

      <div>
        

<ul>
<li><strong>Building a live streaming platform, part I</strong></li>
<li><strong><a href="https://www.maugzoide.com/posts/building-a-live-streaming-platform-part-ii/">Building a live streaming platform, part II</a></strong></li>
</ul>

<hr />

<p>Have you ever got yourself thinking how live streaming works?</p>

<p>This post is a guide to build your own live streaming platform. After reading and following the examples
included on this post, you will be able to publish your content live.</p>

<h2 id="how-live-streaming-works">How live streaming works</h2>

<p>If you consume videos on Youtube, you probably already had contact with a live video transmited over the web.</p>

<p>Most of Youtube content is on demand (VoD) but today we see a lot of people streaming games, news, shows and all kinds of stuff with their smartphones or notebooks.</p>

<p>But how does this happen? How our recording goes through the internet and gets views around the world?</p>

<h3 id="ingest">Ingest</h3>

<p>The first part is popularly known as <strong>ingest</strong> and it is the step where we publish our video.</p>

<p>We can publish a video using well known and open source tools like <a href="https://ffmpeg.org/">ffmpeg</a> and <a href="https://obsproject.com/">OBS Studio</a>. With <strong>ffmpeg</strong> you can publish a video file and loop it, pretending to be a live video. Or use <strong>OBS Studio</strong> to stream a video directly from your webcam.</p>

<p>But where does it go? A server.</p>

<p>There is a variety of protocols used to ingest video. You can use HTTP or the new SRT protocol. For this series of posts we will
use <strong>RTMP</strong> (Real-Time Messaging Protocol), solid, widely used and based on TCP. Developed by Macromedia, it was used in the old Flash player.</p>

<h4 id="a-bit-about-rtmp">A bit about RTMP</h4>

<p>RTMP is an L7 (application layer) protocol. It has some variations like <strong>RTMPS</strong> (Security) and <strong>RTMPE</strong> (Encrypted). They are not the same thing. Although both have the same goals, RTMPS uses SSL certificates while RTMPE uses standard cryptographic algorithms to generate a pair of keys so the client and the server can encrypt and decrypt the data being transmitted.</p>

<p>RTMP works over TCP, which means it guarantees packet delivery and missed packets will be retransmitted. It can also be a bad thing for live streaming because problems like network congestion will cause a delay in your streaming.</p>

<p>Since RTMP is old and it does not receive any specification updates, it does not support modern audio and video codecs.</p>

<p>It is not a big deal, though. With RTMP you can stream videos with <strong>H.264</strong> (video) and <strong>AAC</strong> (audio). These codecs are widely used.</p>

<p>In the past, RTMP was also used for playback. And it is almost impossible now given the high number of people simultaneously watching a streaming. A good strategy is to use RTMP to receive the streaming (ingest) and serve the playlists and chunks using <a href="https://en.wikipedia.org/wiki/HTTP_Live_Streaming">HLS</a> or <a href="https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP">DASH</a> so you can have a CDN on top of it.</p>

<h3 id="bulding-a-server">Bulding a server</h3>

<p><em>Before moving on, I recommend you to <a href="https://github.com/mauricioabreu/building-a-live-streaming-platform">clone the repository</a> containing all assets to run the following commands. Use the 0.1.0 tag (git checkout 0.1.0)</em></p>

<p>Now we already know the protocol we will use, we need a server to receive our video. If you ever heard about nginx, you need to know <strong>NGINX-RTMP</strong>, a RTMP streaming server based on NGINX. With this server you can:</p>

<ul>
<li>Ingest video over RTMP protocol;</li>
<li>Generate HLS and DASH playlists;</li>
<li>Transcode videos with ffmpeg.</li>
</ul>

<p>And some other features that can be checked <a href="https://github.com/arut/nginx-rtmp-module#features">here</a></p>

<p>To ease our job, we can use a Docker image to have a RTMP server up and running.</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4">make runserver</pre></div>
<p>These commands will download the Docker image and start a NGINX-RTMP server ready to receive our live content.</p>

<p>Now we have to publish some live content. Let&rsquo;s generate a video using ffmpeg, sending it to our RTMP server.</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4">make ingest</pre></div>
<p>Executing this command will ingest a colored video to test our server.</p>

<p>There is a lot going on there but the most important part is the very end: rtmp://localhost:1935/stream/colors</p>

<p>This is the RTMP address of our server. Let&rsquo;s break it into pieces so we can understand it better:</p>

<ul>
<li><strong>1935</strong> - default RTMP port;</li>
<li><strong>stream</strong> - application name described in our NGINX configuration;</li>
<li><strong>colors</strong> - streaming name. It identifies each stream your server is handling.</li>
</ul>

<p>NGINX-RTMP is not a simple receiver. It also <em>segments</em> incoming data, generating HLS and DASH ready to be consumed.</p>

<p>Now it is time to test our stream by watching it. You can use <a href="https://www.videolan.org/">VLC</a> to watch it. <strong>VLC</strong> is an open source software to reproduce a wide variety of media, compatible with most of existent codecs.</p>

<p>Open your VLC, go to &ldquo;Open media&rdquo;, choose &ldquo;Network&rdquo; and paste <a href="http://localhost:8080/live/colors.m3u8">http://localhost:8080/live/colors.m3u8</a> there.</p>

<p>If everything is ok, you will see something like this:</p>

<figure>
    <img src="https://www.maugzoide.com/img/colors.jpg" width="50%"/> 
</figure>


<h3 id="resources">Resources</h3>

<p>Here is a list of links to improve your knowledge of video streaming:</p>

<ul>
<li><a href="https://github.com/Eyevinn/streaming-onboarding">Streaming onboarding</a></li>
<li><a href="https://github.com/leandromoreira/ffmpeg-libav-tutorial">Intro video concepts and ffmpeg (until Bonus Round: Adaptive Streaming)</a></li>
<li><a href="https://www.coursera.org/learn/digital">Coursera: Fundamentals of Digital Image and Video Processing</a></li>
<li><a href="https://github.com/leandromoreira/digital_video_introduction">Digital video introduction</a></li>
</ul>

<p>Thank you for reading. Wait you in the next episode.</p>

      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "maugzoide" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Removing code makes me happy</p>
    
     © 2020
    
       · 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
