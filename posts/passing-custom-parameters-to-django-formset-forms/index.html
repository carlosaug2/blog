<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Maurício Antunes">
    <meta name="description" content="Maurício Antunes personal website">
    <meta name="keywords" content="blog,software,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Passing custom parameters to Django formset forms"/>
<meta name="twitter:description" content="An usual question on sites like StackOverflow is: how do I pass a custom parameter to a formset form?
You will end up finding lots of ways to do it. But the most used (at least the more reasonable answer) uses some hard to understand constructions.
Let&rsquo;s say we have an app with two models: Author and Book.
The problem I want to make it possible for the users of my product to add new books on my site."/>

    <meta property="og:title" content="Passing custom parameters to Django formset forms" />
<meta property="og:description" content="An usual question on sites like StackOverflow is: how do I pass a custom parameter to a formset form?
You will end up finding lots of ways to do it. But the most used (at least the more reasonable answer) uses some hard to understand constructions.
Let&rsquo;s say we have an app with two models: Author and Book.
The problem I want to make it possible for the users of my product to add new books on my site." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.maugzoide.com/posts/passing-custom-parameters-to-django-formset-forms/" />
<meta property="article:published_time" content="2016-04-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-04-01T00:00:00+00:00" />


    
      <base href="https://www.maugzoide.com/posts/passing-custom-parameters-to-django-formset-forms/">
    
    <title>
  Passing custom parameters to Django formset forms · Maurício Antunes
</title>

    
      <link rel="canonical" href="https://www.maugzoide.com/posts/passing-custom-parameters-to-django-formset-forms/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.maugzoide.com/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://www.maugzoide.com/css/custom.css" />
    

    
    
    <link rel="icon" type="image/png" href="https://www.maugzoide.com/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.maugzoide.com/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.58.3" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.maugzoide.com/">
      Maurício Antunes
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/">Home</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/posts/">Posts</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/tags/">Tags</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.maugzoide.com/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Passing custom parameters to Django formset forms</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2016-04-01T00:00:00Z'>
                April 1, 2016
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://www.maugzoide.com/tags/django/">django</a></div>

        </div>
      </header>

      <div>
        

<p>An usual question on sites like StackOverflow is: how do I pass a custom
parameter to a formset form?</p>

<p>You will end up finding lots of ways to do it. But the most used (at
least the more reasonable answer) uses some hard to understand
constructions.</p>

<p>Let&rsquo;s say we have an app with two models: Author and Book.</p>

<h2 id="the-problem">The problem</h2>

<p>I want to make it possible for the users of my product to add new books
on my site. But the price can only be added or updated by superusers
(you could use the permissions Django framework here).</p>

<p>Okay! It seems to be an easy task, right? No, it is not.</p>

<p>Django versions lower than 1.9 do not provide an easy waye to do it.
This is why I am writing this post and created a repository with a
project to demonstrate how it actually works. You can <a href="https://github.com/mauricioabreu/formset_custom_arguments">read the code
here</a>.</p>

<h2 id="the-solution">The solution</h2>

<p>This is one of the best solutions I have ever encountered.</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.sourceCode .python" data-lang=".sourceCode .python">BookFormset = inlineformset_factory(
    models.Author,
    models.Book,
    form=forms.BookForm,
    extra=1,
    can_delete=False,
)

BookFormset.form = staticmethod(
    curry(
        forms.BookForm,
        user=request.user
    )
)</code></pre></div>
<h2 id="why-does-it-work">Why does it work?</h2>

<p>The first part of the code creates a formset relating two models and
uses a custom form.</p>

<p>An author can have many books and one book is related to only one
author.</p>

<p>More info about how to handle formsets you can find
<a href="https://docs.djangoproject.com/en/1.8/topics/forms/formsets/">here</a>.</p>

<p>The second part is where the trick happens. In general, the code is
injecting a new form to the formset form in runtime, using the help of
curry.</p>

<p>curry is very similar to the functools.partial function. It takes a
function with pre-defined arguments and returns a new function.</p>

<p>So why does it work? It works because the Django internal form
construction does something like this:</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.sourceCode .python" data-lang=".sourceCode .python">return type(form)(class_name, (form,), form_class_attrs)</code></pre></div>
<p>After passing a function as a form object, it will call our curryed
function, creating a new form with our custom parameters.</p>

<h2 id="a-different-approach">A different approach</h2>

<p>Carl Meyer, Django core developer, has a different style of doing this.
See <a href="http://stackoverflow.com/a/624013">this answer</a> at StackOverflow.
It works in a very similar way, but like he says, it does not affect the
formset like we are doing here. Anyways, I don&rsquo;t think it will affect
the form. You will rarely end up having a business rule attached only to
the formset context.</p>

      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "maugzoide" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Removing code makes me happy</p>
    
     © 2020
    
       · 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
